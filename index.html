<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>salary-calculator | –†–∞—Å—á–µ—Ç –∑–∞—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        :root {
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --primary-dark: #1d4ed8;
            --success: #059669;
            --success-light: #10b981;
            --danger: #dc2626;
            --warning: #d97706;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 8px;
            --radius-lg: 12px;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: rgb(255, 255, 255);
            color: var(--gray-800);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        
    
        
        .content-section {
            padding: 30px;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
       
        
        .tariffs-info {
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid var(--gray-200);
        }
        
        .tariffs-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .tariff-category {
            background: white;
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
            transition: all 0.2s ease;
        }
        
        .tariff-category:hover {
            box-shadow: var(--shadow);
            transform: translateY(-2px);
        }
        
        .tariff-category h4 {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--gray-100);
        }
        
        .tariff-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            font-size: 15px;
            color: var(--gray-700);
            border-bottom: 1px solid var(--gray-100);
            transition: color 0.2s ease;
        }
        
        .tariff-item:hover {
            color: var(--gray-900);
        }
        
        .tariff-item:last-child {
            border-bottom: none;
        }
        
        .tariff-price {
            font-weight: 700;
            color: var(--success);
            font-size: 16px;
        }
        
        .week-setup {
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-100) 100%);
            border: 2px dashed var(--gray-300);
            border-radius: var(--radius-lg);
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .week-inputs {
            display: flex;
            gap: 20px;
            align-items: end;
            flex-wrap: wrap;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 1;
            min-width: 200px;
        }
        
        .input-group label {
            font-size: 14px;
            color: var(--gray-700);
            font-weight: 500;
        }
        
        .input-group input, select {
            padding: 12px 16px;
            border: 1px solid var(--gray-300);
            border-radius: var(--radius);
            font-size: 15px;
            background: white;
            transition: all 0.2s ease;
        }
        
        .input-group input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .controls {
            background: white;
            padding: 25px;
            border-radius: var(--radius-lg);
            margin-bottom: 30px;
            border: 1px solid var(--gray-200);
        }
        
        .controls-inner {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: translateY(-1px);
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 2px 4px rgba(37, 99, 235, 0.2);
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            box-shadow: 0 4px 8px rgba(37, 99, 235, 0.3);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
            box-shadow: 0 2px 4px rgba(5, 150, 105, 0.2);
        }
        
        .btn-success:hover {
            background: var(--success-light);
            box-shadow: 0 4px 8px rgba(5, 150, 105, 0.3);
        }
        
        .btn-outline {
            background: transparent;
            color: var(--gray-700);
            border: 1px solid var(--gray-300);
        }
        
        .btn-outline:hover {
            background: var(--gray-50);
            border-color: var(--gray-400);
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
            box-shadow: 0 2px 4px rgba(220, 38, 38, 0.2);
        }
        
        .btn-danger:hover {
            background: #b91c1c;
            box-shadow: 0 4px 8px rgba(220, 38, 38, 0.3);
        }
        
        .weeks-container {
            margin-bottom: 30px;
        }
        
        .week-section {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            margin-bottom: 25px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.2s ease;
        }
        
        .week-section:hover {
            box-shadow: var(--shadow-lg);
        }
        
        .week-header {
            padding: 25px;
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-100) 100%);
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .week-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .week-dates {
            color: var(--gray-600);
            font-size: 14px;
            margin-top: 4px;
        }
        
        .days-grid {
            padding: 25px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .day-card {
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            overflow: hidden;
            background: white;
            transition: all 0.2s ease;
        }
        
        .day-card:hover {
            border-color: var(--gray-300);
            box-shadow: var(--shadow);
        }
        
        .day-header {
            padding: 20px;
            background: var(--gray-50);
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .day-title {
            font-weight: 600;
            color: var(--gray-900);
            font-size: 16px;
        }
        
        .day-total {
            font-weight: 700;
            color: var(--success);
            font-size: 18px;
        }
        
        .day-content {
            padding: 20px;
        }
        
        .lessons-list {
            margin-bottom: 15px;
        }
        
        .lesson-item {
            padding: 16px;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            margin-bottom: 12px;
            background: var(--gray-50);
            transition: all 0.2s ease;
        }
        
        .lesson-item:hover {
            border-color: var(--gray-300);
            background: white;
        }
        
        .lesson-time {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            font-size: 15px;
            color: var(--gray-700);
        }
        
        .time-input {
            width: 120px;
            padding: 8px 12px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }
        
        .time-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
        }
        
        .lesson-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--gray-700);
            white-space: nowrap;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: var(--primary);
        }
        
        .remove-btn {
            background: var(--danger);
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .remove-btn:hover {
            background: #b91c1c;
            transform: scale(1.1);
        }
        
        .add-lesson-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 14px;
            width: 100%;
            margin-bottom: 12px;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .add-lesson-btn:hover:not(:disabled) {
            background: var(--primary-dark);
        }
        
        .add-lesson-btn:disabled {
            background: var(--gray-400);
            cursor: not-allowed;
            transform: none;
        }
        
        .lesson-counter {
            font-size: 13px;
            color: var(--gray-500);
            text-align: center;
            margin-bottom: 15px;
        }
        
        .compensation-section {
            border-top: 1px solid var(--gray-200);
            padding-top: 15px;
        }
        
        .compensation-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border: 1px solid #fcd34d;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .count-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .count-btn {
            background: var(--gray-600);
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .count-btn:hover {
            background: var(--gray-700);
        }
        
        .count-input {
            width: 60px;
            text-align: center;
            padding: 6px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 14px;
        }
        
        .week-total {
            padding: 20px 25px;
            background: var(--gray-50);
            border-top: 1px solid var(--gray-200);
            text-align: right;
            color: rgb(0, 0, 0);
            font-size: 18px;
        }
        
        .results-section {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 1px solid #bbf7d0;
            border-radius: var(--radius-lg);
            padding: 30px;
            margin-top: 30px;
        }
        
        
        .total-amount {
            font-size: 42px;
            font-weight: 800;
            color: var(--success);
            text-align: center;
            margin: 25px 0;
            text-shadow: 0 2px 4px rgba(5, 150, 105, 0.1);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 25px;
        }
        
        .stat-item {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: var(--radius);
            border: 1px solid #dcfce7;
            transition: all 0.2s ease;
        }
        
        .stat-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--gray-900);
            margin: 8px 0;
        }
        
        .stat-label {
            font-size: 14px;
            color: var(--gray-600);
            font-weight: 500;
        }
        
        .hidden {
            display: none;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 40px;
            color: var(--gray-500);
        }
        
        .empty-state p {
            font-size: 16px;
            margin-top: 15px;
        }
        
        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 5'><path fill='%23666' d='M2 0L0 2h4zm0 5L0 3h4z'/></svg>");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
            padding-right: 40px;
        }
        
        @media (max-width: 768px) {
            .tariffs-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .controls-inner {
                justify-content: stretch;
            }
            
            .btn {
                flex: 1;
                min-width: 140px;
                justify-content: center;
            }
            
            .days-grid {
                grid-template-columns: 1fr;
            }
            
            .week-inputs {
                flex-direction: column;
            }
            
            .input-group {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-content">

            
            <div class="content-section">
                <div class="tariffs-info">
                    <div class="section-title">–¢–∞—Ä–∏—Ñ–Ω–∞—è —Å–µ—Ç–∫–∞</div>
                    <div class="tariffs-grid">
                        <div class="tariff-category">
                            <h4>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</h4>
                            <div class="tariff-item">
                                <span>–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —É—Ä–æ–∫</span>
                                <span class="tariff-price">6 000 ‚Ç∏</span>
                            </div>
                            <div class="tariff-item">
                                <span>–£—Ä–æ–∫ —Å –ø–æ–ª–Ω–æ–π –≥—Ä—É–ø–ø–æ–π</span>
                                <span class="tariff-price">8 000 ‚Ç∏</span>
                            </div>
                            <div class="tariff-item">
                                <span>–û—Ç—Ä–∞–±–æ—Ç–∫–∞</span>
                                <span class="tariff-price">3 000 ‚Ç∏</span>
                            </div>
                            <div class="tariff-item">
                                <span>–ü—Ä–æ–±–Ω—ã–π —É—Ä–æ–∫</span>
                                <span class="tariff-price">2 000 ‚Ç∏</span>
                            </div>
                        </div>
                        <div class="tariff-category">
                            <h4>–ü–æ–º–æ—â–Ω–∏–∫ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è</h4>
                            <div class="tariff-item">
                                <span>–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —É—Ä–æ–∫</span>
                                <span class="tariff-price">3 000 ‚Ç∏</span>
                            </div>
                            <div class="tariff-item">
                                <span>–£—Ä–æ–∫ —Å –ø–æ–ª–Ω–æ–π –≥—Ä—É–ø–ø–æ–π</span>
                                <span class="tariff-price">4 000 ‚Ç∏</span>
                            </div>
                            <div class="tariff-item">
                                <span>–ü—Ä–æ–±–Ω—ã–π —É—Ä–æ–∫</span>
                                <span class="tariff-price">1 000 ‚Ç∏</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="week-setup">
                    <div class="section-title">–î–æ–±–∞–≤–∏—Ç—å —É—á–µ–±–Ω—É—é –Ω–µ–¥–µ–ª—é</div>
                    <div class="week-inputs">
                        <div class="input-group">
                            <label>–ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏</label>
                            <input type="date" id="weekStartDate">
                        </div>
                        <div class="input-group">
                            <label>–ö–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏</label>
                            <input type="date" id="weekEndDate">
                        </div>
                        <button class="btn btn-primary" onclick="addWeek()">–î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–µ–ª—é</button>
                    </div>
                </div>
                
                <div class="controls">
                    <div class="controls-inner">
                        <div class="input-group">
                            <select id="roleSelect">
                                <option value="teacher">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</option>
                                <option value="assistant">–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç</option>
                            </select>
                        </div>
                        <button class="btn btn-success" onclick="calculateSalary()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∑–∞—Ä–∞–±–æ—Ç–æ–∫</button>
                        <button class="btn btn-danger" onclick="clearAllWeeks()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
                        <button class="btn btn-outline" onclick="saveDataToFile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
                        <label class="btn btn-outline" style="cursor:pointer; position:relative;">
                            –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                            <input type="file" id="loadFileInput" accept=".json" style="position:absolute; left:0; top:0; width:100%; height:100%; opacity:0; cursor:pointer;" onchange="loadDataFromFile(event)">
                        </label>
                        <button class="btn btn-primary" onclick="shareToWhatsApp()">–û—Ç—á–µ—Ç –≤ WhatsApp</button>
                    </div>
                </div>
                
                <div class="weeks-container" id="weeksContainer">
                    <div class="empty-state" id="emptyState">
                        <p>–ù–∞—á–Ω–∏—Ç–µ —Ä–∞–±–æ—Ç—É - –¥–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é —É—á–µ–±–Ω—É—é –Ω–µ–¥–µ–ª—é!</p>
                    </div>
                </div>
                
                <div class="results-section hidden" id="resultsSection">
                    <div class="section-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞</div>
                    <div class="total-amount" id="totalAmount">0 ‚Ç∏</div>
              
                    <div class="stats-grid">
                        
                        <div class="stat-item">
                            <div class="stat-value" id="standardLessons">0</div>
                            <div class="stat-label">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —É—Ä–æ–∫–æ–≤</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="fullGroupLessons">0</div>
                            <div class="stat-label">–£—Ä–æ–∫–æ–≤ —Å –ø–æ–ª–Ω–æ–π –≥—Ä—É–ø–ø–æ–π</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="compensations">0</div>
                            <div class="stat-label">–û—Ç—Ä–∞–±–æ—Ç–æ–∫</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="trialLessons">0</div>
                            <div class="stat-label">–ü—Ä–æ–±–Ω—ã—Ö —É—Ä–æ–∫–æ–≤</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
const prices = {
    teacher: { standard: 6000, fullGroup: 8000, compensation: 3000, trial: 2000 },
    assistant: { standard: 3000, fullGroup: 4000, trial: 1000 }
};

function formatDateForFilename(date) {
    const d = new Date(date);
    const day = String(d.getDate()).padStart(2, '0');
    const month = String(d.getMonth() + 1).padStart(2, '0');
    return `${day}.${month}`;
}

const timeSlots = [
    { start: '10:00', end: '12:00' },
    { start: '12:00', end: '14:00' },
    { start: '15:00', end: '17:00' },
    { start: '17:00', end: '19:00' }
];

let weeks = [];
let weekCounter = 1;

function setDefaultDates() {
    const today = new Date();
    const startOfWeek = new Date(today);
    startOfWeek.setDate(today.getDate() - today.getDay() + 1);
    const endOfWeek = new Date(startOfWeek);
    endOfWeek.setDate(startOfWeek.getDate() + 6);
    document.getElementById('weekStartDate').valueAsDate = startOfWeek;
    document.getElementById('weekEndDate').valueAsDate = endOfWeek;
}

function getRole() {
    return document.getElementById('roleSelect').value;
}

function addWeek() {
    const startDate = document.getElementById('weekStartDate').value;
    const endDate = document.getElementById('weekEndDate').value;
    if (!startDate || !endDate) return alert('–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—ã –Ω–µ–¥–µ–ª–∏');

    const currentId = `week${weekCounter}`;
    const week = {
        id: currentId,
        number: weekCounter,
        startDate: new Date(startDate),
        endDate: new Date(endDate),
        days: generateWeekDays(new Date(startDate), new Date(endDate), currentId)
    };
    weeks.push(week);
    weekCounter++;

    renderSingleWeek(week);
    document.getElementById('emptyState').style.display = 'none';
    setDefaultDates();
}

function generateWeekDays(startDate, endDate, weekId) {
    const days = [];
    const dayNames = ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫','–í—Ç–æ—Ä–Ω–∏–∫','–°—Ä–µ–¥–∞','–ß–µ—Ç–≤–µ—Ä–≥','–ü—è—Ç–Ω–∏—Ü–∞','–°—É–±–±–æ—Ç–∞','–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'];
    const current = new Date(startDate);
    while (current <= endDate) {
        const idx = current.getDay();
        days.push({
            id: `${weekId}_day${formatDateId(current)}`,
            name: `${dayNames[idx === 0 ? 6 : idx - 1]} ${formatDate(current)}`,
            date: new Date(current)
        });
        current.setDate(current.getDate() + 1);
    }
    return days;
}

function formatDate(date) {
    return date.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit' });
}
function formatDateId(date) {
    return `${date.getDate()}${date.getMonth()}${date.getFullYear()}`;
}

function renderSingleWeek(week) {
    const container = document.getElementById('weeksContainer');
    const weekSection = document.createElement('div');
    weekSection.className = 'week-section';
    weekSection.innerHTML = `
        <div class="week-header">
            <div>
                <div class="week-title">–ù–µ–¥–µ–ª—è ${week.number}</div>
                <div class="week-dates">${formatDate(week.startDate)} - ${formatDate(week.endDate)}</div>
            </div>
            <button class="btn btn-danger" onclick="removeWeek('${week.id}')">–£–¥–∞–ª–∏—Ç—å –Ω–µ–¥–µ–ª—é</button>
        </div>
        <div class="days-grid">
            ${week.days.map(day => `
                <div class="day-card">
                    <div class="day-header">
                        <div class="day-title">${day.name}</div>
                        <div class="day-total" id="${day.id}Total">0 ‚Ç∏</div>
                    </div>
                    <div class="lessons-list" id="${day.id}Lessons"></div>
                    <button class="add-lesson-btn" id="${day.id}AddBtn" onclick="addLesson('${day.id}')">+ –î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–∫</button>
                    <div class="lesson-counter" id="${day.id}Counter">0/4 —É—Ä–æ–∫–æ–≤</div>
                    <div class="compensation-section">
                        <div class="compensation-item">
                            <span>–û—Ç—Ä–∞–±–æ—Ç–∫–∞</span>
                            <div class="checkbox-group">
                            <input type="checkbox" id="${day.id}Compensation" onchange="updateDayTotal('${day.id}')">
                            <label for="${day.id}Compensation">–ë—ã–ª–∞ –æ—Ç—Ä–∞–±–æ—Ç–∫–∞</label>
                            <input type="number" id="${day.id}CompCount" class="count-input" min="1" value="1" onchange="updateDayTotal('${day.id}')">
                            </div>
                        </div>
                        <div class="compensation-item">
                            <span>–ü—Ä–æ–±–Ω—ã–π —É—Ä–æ–∫</span>
                            <div class="checkbox-group">
                            <input type="checkbox" id="${day.id}Trial" onchange="updateDayTotal('${day.id}')">
                            <label for="${day.id}Trial">–ë—ã–ª –ø—Ä–æ–±–Ω—ã–π</label>
                            <input type="number" id="${day.id}TrialCount" class="count-input" min="1" value="1" onchange="updateDayTotal('${day.id}')">
                            </div>
                        </div>
                    </div>
                </div>
            `).join('')}
        </div>
        <div class="week-total" id="${week.id}Total">–ò—Ç–æ–≥–æ –∑–∞ –Ω–µ–¥–µ–ª—é: 0 ‚Ç∏</div>
    `;
    container.appendChild(weekSection);
}

function renderWeeks() {
    const container = document.getElementById('weeksContainer');
    const emptyState = document.getElementById('emptyState');
    container.innerHTML = '';
    
    if (weeks.length === 0) {
        emptyState.style.display = 'block';
        container.appendChild(emptyState);
        return;
    }
    
    emptyState.style.display = 'none';
    
    // –†–µ–Ω–¥–µ—Ä–∏–º –≤—Å–µ –Ω–µ–¥–µ–ª–∏
    weeks.forEach(week => {
        renderSingleWeek(week);
    });
}



function removeWeek(id) {
    weeks = weeks.filter(w => w.id !== id);
    renderWeeks();
    document.getElementById('resultsSection').classList.add('hidden');
}

function addLesson(dayId) {
    const container = document.getElementById(dayId + 'Lessons');
    const count = container.querySelectorAll('.lesson-item').length;
    if (count >= 4) return alert('–ú–∞–∫—Å–∏–º—É–º 4 —É—Ä–æ–∫–∞ –≤ –¥–µ–Ω—å!');
    const slot = timeSlots[count];
    const lesson = document.createElement('div');
    lesson.className = 'lesson-item';
    lesson.innerHTML = `
        <div class="lesson-time">
            <input type="time" class="time-input" value="${slot.start}" onchange="updateDayTotal('${dayId}')">
            <span>-</span>
            <input type="time" class="time-input" value="${slot.end}" onchange="updateDayTotal('${dayId}')">
        </div>
        <div class="lesson-controls">
            <div class="lesson-checkboxes">
                <div class="checkbox-group">
                    <input type="checkbox" onchange="updateDayTotal('${dayId}')">
                    <label>–ü–æ–ª–Ω–∞—è –≥—Ä—É–ø–ø–∞</label>
                </div>
            </div>
            <button class="remove-btn" onclick="removeLesson('${dayId}', this)">√ó</button>
        </div>`;
    container.appendChild(lesson);
    updateLessonCounter(dayId);
    updateDayTotal(dayId);
}

function renderLesson(dayId, lessonData) {
    const container = document.getElementById(dayId + 'Lessons');
    const lesson = document.createElement('div');
    lesson.className = 'lesson-item';
    lesson.innerHTML = `
        <div class="lesson-time">
            <input type="time" class="time-input" value="${lessonData.start || ''}" onchange="updateDayTotal('${dayId}')">
            <span>-</span>
            <input type="time" class="time-input" value="${lessonData.end || ''}" onchange="updateDayTotal('${dayId}')">
        </div>
        <div class="lesson-controls">
            <div class="checkbox-group">
                <input type="checkbox" ${lessonData.fullGroup ? 'checked' : ''} onchange="updateDayTotal('${dayId}')">
                <label>–ü–æ–ª–Ω–∞—è –≥—Ä—É–ø–ø–∞</label>
            </div>
            <button class="remove-btn" onclick="removeLesson('${dayId}', this)">√ó</button>
        </div>`;
    container.appendChild(lesson);
}

function removeLesson(dayId, btn) {
    btn.closest('.lesson-item').remove();
    updateLessonCounter(dayId);
    updateDayTotal(dayId);
}



function updateLessonCounter(dayId) {
    const lessons = document.querySelectorAll(`#${dayId}Lessons .lesson-item`).length;
    const counter = document.getElementById(dayId + 'Counter');
    const addBtn = document.getElementById(dayId + 'AddBtn');
    counter.textContent = `${lessons}/4 —É—Ä–æ–∫–æ–≤`;
    addBtn.disabled = lessons >= 4;
    addBtn.textContent = lessons >= 4 ? '–ú–∞–∫—Å–∏–º—É–º —É—Ä–æ–∫–æ–≤' : '+ –î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–∫';
}

function updateDayTotal(dayId) {
    let total = 0;
    const lessons = document.querySelectorAll(`#${dayId}Lessons .lesson-item`);
    const compensation = document.getElementById(dayId + 'Compensation')?.checked;
    const compCount = parseInt(document.getElementById(dayId + 'CompCount')?.value || 1);
    const trial = document.getElementById(dayId + 'Trial')?.checked;
    const trialCount = parseInt(document.getElementById(dayId + 'TrialCount')?.value || 1);
    const role = getRole();

    // —Å—á–∏—Ç–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏ –ø–æ–ª–Ω—ã–µ —É—Ä–æ–∫–∏
    lessons.forEach(l => {
        const [full] = l.querySelectorAll('input[type="checkbox"]');
        total += full.checked ? prices[role].fullGroup : prices[role].standard;
    });

    // –¥–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Ä–∞–±–æ—Ç–∫–∏
    if (compensation && role === 'teacher') total += prices.teacher.compensation * compCount;

    // –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–±–Ω—ã–µ
    if (trial) {
        const price = prices[role].trial || prices.teacher.trial;
        total += price * trialCount;
    }

    document.getElementById(dayId + 'Total').textContent = total.toLocaleString() + ' ‚Ç∏';
    updateWeekTotal(dayId.split('_')[0]);
}


function updateWeekTotal(weekId) {
    let sum = 0;
    document.querySelectorAll(`[id^="${weekId}_day"][id$="Total"]`).forEach(e => {
        const n = parseInt(e.textContent.replace(/\D/g, '')) || 0;
        sum += n;
    });
    document.getElementById(weekId + 'Total').textContent = `–ò—Ç–æ–≥–æ –∑–∞ –Ω–µ–¥–µ–ª—é: ${sum.toLocaleString()} ‚Ç∏`;
}

function calculateSalary() {
    let total = 0, s = 0, f = 0, c = 0, t = 0;
    const role = getRole();

    // ‚úÖ –±–µ—Ä—ë–º —Ä–µ–∞–ª—å–Ω—ã–µ —Å—É–º–º—ã –∏–∑ week-total
    document.querySelectorAll('.week-total').forEach(el => {
        const sum = parseInt(el.textContent.replace(/\D/g, '')) || 0;
        total += sum;
    });

    // —Å—á–∏—Ç–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω–æ
    weeks.forEach(week => {
        week.days.forEach(day => {
            const lessons = document.querySelectorAll(`#${day.id}Lessons .lesson-item`);
            lessons.forEach(l => {
                const [full] = l.querySelectorAll('input[type="checkbox"]');
                if (full.checked) f++;
                else s++;
            });

            const comp = document.getElementById(day.id + 'Compensation')?.checked;
            const compCount = parseInt(document.getElementById(day.id + 'CompCount')?.value || 1);
            if (comp && role === 'teacher') c += compCount;

            const trial = document.getElementById(day.id + 'Trial')?.checked;
            const trialCount = parseInt(document.getElementById(day.id + 'TrialCount')?.value || 1);
            if (trial) t += trialCount;
        });
    });

    // –æ–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    document.getElementById('totalAmount').textContent = total.toLocaleString() + ' ‚Ç∏';
    document.getElementById('standardLessons').textContent = s;
    document.getElementById('fullGroupLessons').textContent = f;
    document.getElementById('compensations').textContent = c;
    document.getElementById('trialLessons').textContent = t; // üîπ –¥–æ–±–∞–≤–∏–º –≤ HTML
    document.getElementById('resultsSection').classList.remove('hidden');
    document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
}



function clearAllWeeks() {
    if (confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –Ω–µ–¥–µ–ª–∏?')) {
        weeks = [];
        weekCounter = 1;
        renderWeeks();
        document.getElementById('resultsSection').classList.add('hidden');
    }
}

function shareToWhatsApp() {
  const role = getRole();
  const total = document.getElementById('totalAmount').textContent;
  const s = document.getElementById('standardLessons').textContent;
  const f = document.getElementById('fullGroupLessons').textContent;
  const c = document.getElementById('compensations').textContent;
  const t = document.getElementById('trialLessons').textContent; // üîπ –¥–æ–±–∞–≤–ª–µ–Ω–æ

  let weekSummary = "";
  weeks.forEach(week => {
    let std = 0, full = 0;
    week.days.forEach(day => {
      const lessons = document.querySelectorAll(`#${day.id}Lessons .lesson-item`);
      lessons.forEach(l => {
        const [fullCheck] = l.querySelectorAll('input[type="checkbox"]');
        fullCheck.checked ? full++ : std++;
      });
    });
    if (std > 0 || full > 0) {
      weekSummary += `‚ñ™Ô∏è –ù–µ–¥–µ–ª—è ${week.number}: ${std} –æ–±—ã—á–Ω—ã—Ö, ${full} –ø–æ–ª–Ω—ã—Ö\n`;
    }
  });

  const message =
    `*–û—Ç—á—ë—Ç –ø–æ –∑–∞–Ω—è—Ç–∏—è–º (${role === 'teacher' ? '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å' : '–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç'})*\n\n` +
    (weekSummary ? `üìÖ *–ò—Ç–æ–≥ –ø–æ –Ω–µ–¥–µ–ª—è–º:*\n${weekSummary}\n` : "") +
    `üìä *–û–±—â–∏–π –∏—Ç–æ–≥:*\n` +
    `–û–±—ã—á–Ω—ã—Ö –∑–∞–Ω—è—Ç–∏–π: ${s}\n` +
    `–ü–æ–ª–Ω—ã—Ö –≥—Ä—É–ø–ø: ${f}\n` +
    `–ü—Ä–æ–±–Ω—ã—Ö —É—Ä–æ–∫–æ–≤: ${t}\n` + // üîπ –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞
    (role === 'teacher' ? `–û—Ç—Ä–∞–±–æ—Ç–æ–∫: ${c}\n` : "") +
    `\nüí∞ *–í—Å–µ–≥–æ:* ${total}`;

  const url = `https://wa.me/?text=${encodeURIComponent(message)}`;
  window.open(url, '_blank');
}



function saveDataToFile() {
    if (weeks.length === 0) return alert("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!");

    weeks.forEach(weekObj => {
        weekObj.days.forEach(day => {
           
            const lessons = document.querySelectorAll(`#${day.id}Lessons .lesson-item`);
            day.lessons = Array.from(lessons).map(l => {
                const times = l.querySelectorAll('input[type="time"]');
                const [full] = l.querySelectorAll('input[type="checkbox"]');
                return {
                    start: times[0].value,
                    end: times[1].value,
                    fullGroup: full.checked
                };
            });

         
            const comp = document.getElementById(`${day.id}Compensation`);
            const compCount = document.getElementById(`${day.id}CompCount`);
            const trial = document.getElementById(`${day.id}Trial`);
            const trialCount = document.getElementById(`${day.id}TrialCount`);
            day.compensation = { checked: comp?.checked || false, count: parseInt(compCount?.value || 1) };
            day.trial = { checked: trial?.checked || false, count: parseInt(trialCount?.value || 1) };
        });
    });

    const data = JSON.stringify(weeks, null, 2);
    const blob = new Blob([data], { type: "application/json" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    
 
    let fileName = "–º–æ–∏_–∑–∞–Ω—è—Ç–∏—è";
    if (weeks.length > 0) {
        const firstWeek = weeks[0];
        const lastWeek = weeks[weeks.length - 1];
        
        const startDate = formatDateForFilename(firstWeek.startDate);
        const endDate = formatDateForFilename(lastWeek.endDate);
        
        fileName = `–º–æ–∏_–∑–∞–Ω—è—Ç–∏—è_${startDate}-${endDate}.json`;
    } else {
        fileName = "–º–æ–∏_–∑–∞–Ω—è—Ç–∏—è.json";
    }
    
    link.download = fileName;
    link.click();
}


function formatDateForFilename(date) {
    const d = new Date(date);
    const day = String(d.getDate()).padStart(2, '0');
    const month = String(d.getMonth() + 1).padStart(2, '0');
    return `${day}.${month}`;
}



function loadDataFromFile(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const data = JSON.parse(e.target.result);
            if (!Array.isArray(data)) throw new Error("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞");

            data.forEach(w => {
                w.startDate = new Date(w.startDate);
                w.endDate = new Date(w.endDate);
                if (Array.isArray(w.days)) {
                    w.days.forEach(d => {
                        d.date = new Date(d.date);
                    });
                }
            });

            weeks = data;
            
            if (weeks.length > 0) {
                weekCounter = Math.max(...weeks.map(w => w.number)) + 1;
            }
            
            renderWeeks(); 
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∏—Ç–æ–≥–∏
            weeks.forEach(w => {
                w.days.forEach(d => {
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —É—Ä–æ–∫–∏
                    if (d.lessons && Array.isArray(d.lessons)) {
                        d.lessons.forEach(lesson => renderLesson(d.id, lesson));
                        updateLessonCounter(d.id);
                    }
                    
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ç—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø—Ä–æ–±–Ω—ã–µ —É—Ä–æ–∫–∏
                    if (d.compensation) {
                        const comp = document.getElementById(`${d.id}Compensation`);
                        const compCount = document.getElementById(`${d.id}CompCount`);
                        if (comp) comp.checked = d.compensation.checked;
                        if (compCount) compCount.value = d.compensation.count;
                    }
                    if (d.trial) {
                        const trial = document.getElementById(`${d.id}Trial`);
                        const trialCount = document.getElementById(`${d.id}TrialCount`);
                        if (trial) trial.checked = d.trial.checked;
                        if (trialCount) trialCount.value = d.trial.count;
                    }
                    
                    // –û–ë–ù–û–í–õ–Ø–ï–ú –ò–¢–û–ì–ò –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
                    updateDayTotal(d.id);
                });
            });
            
            alert("‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!");
            
        } catch (err) {
            alert("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞: " + err.message);
            console.error(err);
        }
    };
    reader.readAsText(file);
    
    event.target.value = '';
}





</script>

</body>
</html>


